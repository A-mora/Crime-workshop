---
title: "Exploratory Data Analysis using the Crime Survey for England and Wales"
author: "Ana Morales"
date: "`r Sys.Date()`"
fontsize: 12pt
output: 
html_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this practical you will be analysing a sample of the teaching dataset  of the Crime Survey for England and Wales available [here](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=7911) from the [UK Data Service](https://www.ukdataservice.ac.uk/). But you can access it from the folder **Crime_workshop** in the "C:\Work" folder of the PC in the cluster.

## 1. Before we start

#### 1.1. Define a working directory

You can use the directory  on University-owned machines, as it provides a stable drive to work on ("C:\Work"). If you're using your own machine, you can specify any folder you find convenient.

Also note that you need to take your data and results with you and delete what you store on the C-drive after this session (if you are not using your own laptop).  


#### 1.2. Open a new Script

First, open a new script in R studio and save it in your working directory, so you will be able to access this script at a later time if you want to revise or modify a code.  

In R Studio:  

Go to File... New File.... R script
  

#### 1.3. Load the packages

Remember to load the packages. We will be using `tidyverse` and `haven`

```{r}

library(haven)
library(tidyverse)
```



As a first step in a research project we need to start with a purpose:




## Central tendency measures (change title)

### 2. Import the data into R

Import the dataset called hse_data.dta into the console using your desired method (code or point and click). This dataset can only be imported if you have loaded the package `haven`. 

```{r, echo=FALSE}
setwd("C:/Users/Amanda/Desktop/anita/Crime-workshop")

csew <- read_dta("CSEW/UKDA-7911-stata/stata/stata11/csew1314_teaching_eul2.dta")

```

```{r, eval=FALSE}

csew<-read_dta(".dta") 

```



### 3. Data exploration

- **3.1 Dataset exploration**

**Task 1**: Inspect the dataset, use the function View()

```{r, eval=FALSE}

View(csew)

```

You can also use the function `head()` that shows you the first 6 rows of the data set, this function is usefull to have a look at the data within the console, specially when you havelarge datasets.

There is also an antithesis function to `head()` called `tail()`. Can you guess what does that function do?   

(**Hint**: you can run the code in the console and see it by yourself, or a wuick search in google may also help.)

```{r, echo=FALSE}
head (csew)
```

Data obtained from the UK Data Service always came with a wealth of resources and user guides that help us to understand the data, so I would always encourgae you to check the documentation associated with the data used.These documentation also includes information about the sample, the questionnaire, the variables availables and how to use them.   

Sadly, this is not always the case with data from different sources, in those cases the initial exploration of the data is probably our main source of information about the data itself.

Now that we got the data in the console, let's start with our data exploration:


*Task 1.1* How many observations does the data have?____________


*Task 1.2* How many variables?______________




Another function used to get a "glimpse" at your data is using the function `glimpse()`.



```{r, echo=FALSE}

glimpse(csew)


```


Note the data type of almost all variables is `<dbl+lbl>`.  These are labelled variables in the haven package. It's the way to identify variables with labels from Stata.



- **3.2 Variable exploration**  


Let's use another function to have a closer look, this time at the variables. Let's use this with the variable 'sex'
```{r}

attributes(csew$sex)

```


We have the `$class` attribute which says that `sex` is a haven_labelled type. We also have the `$labels` attribute which are the Value Labels of the variable `sex`: 1 Man, 2 Woman

We could have also used `class(hse$sex)` to check the type of the variable.


**Task 2** Inspect other variables with attributes() and class()




## 4. Understanding our data

Now that we have had a look at what variables we have, we need to start looking for other aspects of the exploratory data analysis (EDA) process. These are some of the things to look out for: 

- Checking for outliers (unusual values)
- Looking at the distribution of the variables
- Exploring some relationships and patterns
- Checking for missing cases


Here we start the data exploration of the categorical variables (also called factors).

Let's see what happens when we ask for a frequency table

```{r}

table(csew$sex)
```

Right now, the variable does not contain any visible label that help us to identify each category of response, although we know the underlying values of each label thanks to the `attribute` function.

This is one of the inconveniences of working with data with labels in R, but it is good for you to know what to do in this case.


Although we can use the data as it is, I prefer to see the values of the variables, so we are going to change the class of some varibles to make them easier to analyse.


We can use the function `as_factor()` from the package **haven** to convert the variable into a factor variable (equivalent to categorical variable). Copy the following code in your console.  

```{r}

csew$sexf<-as_factor(csew$sex) 
table(csew$sexf)
```

Here we created a new variable with the suffix "f" (for factor). 


*Task 3:* Convert the following variables into factor using the example code before.

- **Univariate analysis**


We can use a series of descriptive statistics and graphs to help us to undertand and make sense of the data.

Univariate exploration is when we look at the characteristics of each variable of interest independently


**Univariate Descriptive statistic for continuous (numeric) data**

We can get summries of the main statistics using the base function `summary()`. This function gives us the minimum and maximun values, the mean, median and the quartiles.   

It is really useful to check for extreme values. Let's have a go

```{r}
#This uses basic functions from R
summary(csew$age)
```

`summary()` does not gives any measure of the spread of the, we can use other functions available in base R for that `sd()` for standard deviation.

```{r}
# Standard deviation
sd(csew$age)

```

so far we have used two different functions to 

```{r}

#using function from the package dplyr (tidyverse)
csew %>%
  summarise(mean= mean(age),
            sd= sd(age),
            median = median(age),
            min = min(age),
            max = max(age)) 

```


The distribution of the variable age seems reasonable, the mean and the median are very similar. 

The standard deviation shows how spread the data are. A standard deviation of 57.68 is quite high, which might indicate a lot of variation in the distribution of age. This is clearly hinting that there is something odd about the variable.

We also saw that the maximum value for age is **999**, which is clearly a number out of range; Nobody can live for 999 years! This is also a good way to check for outliers.

In certain cases the maximun values can be less obvious, so it would be difficult to determine whether there are outliers or data errors, that is why we need more visual exploration to check this.



## subsetting (filter)

There are a lot of small children children in this dataset (4354 younger than 5), we saw this using the  `table(hse_data$age[hse_data$age<5])` which gives the total number of children younger than 5.





# Subsetting observations -Getting statistics for a sample of the data
sum(csew$age[csew$age<5])
```

```{r}

#using function from the package dplyr (tidyverse)
hse_data%>%
  summarise(mean= mean(age),
            sd= sd(age),
            median = median(age),
            quant) 

# Subsetting observations -Getting statistics for a sample of the data
hse_data %>%
  filter(age <5) %>%
  summarise(younger_5 = sum(age))
              
 


```




*Task 4:* Get summary statistics for the variables height, BMI and weight. Use the subsetting operation for exploring certain groups.


*Task 4.1* Write down a short description of the main statistics you've obtained



*Task 4.2* Is there any unusual value in the variables you have analysed?









## Visual exploration

## Association between variables
# Correlation
# Crosstab
# Visual exploration

